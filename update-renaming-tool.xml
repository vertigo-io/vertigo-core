<?xml version="1.0" encoding="UTF-8"?>

<!-- ====================================================================== -->
<!-- Ant build file (http://ant.apache.org/) for Ant 1.6.2 or above.        -->
<!-- ====================================================================== -->
<project name="Vertigo Update Renaming Tool" default="">
	<!-- =================================================================== -->
	<!-- Proprietes                                                          -->
	<!-- =================================================================== -->
	<property name="src.encoding" value="utf8" />
	<property name="src.path" value="." />
	
	<target name="CONST Java Entity to CamelCase java" description="Replace old java definitions to CamelCase definition new in vertigo 2.0">
			<copy todir="${src.path}\generated-java" encoding="${src.encoding}" overwrite="true">
				<fileset dir="${src.path}">
					<include name="**/*.java" />
				</fileset>
				<filterchain>
				 	<tokenfilter>
				 		<scriptfilter language="javascript">
							function upperCamelCase(str) {
							  return str.replace(/((?:\W|^)\w)|_+(\w)|\w/g, function(match, p1, p2, index) {
							   if (p1) { return p1.toUpperCase();} 
							   if (p2) { return p2.toUpperCase();} 
							   return match.toLowerCase();
							  });
							}
				 			function lowerCamelCase(str) {
							  return str.replace(/((?:\W|^)\w)|_+(\w)|\w/g, function(match, p1, p2, index) {
							   if (p1) { return p1.toLowerCase();} 
							   if (p2) { return p2.toUpperCase();} 
							   return match.toLowerCase();
							  });
							}
				 			//replace domain
							var result = self.getToken().replace(/((?:domain|name|dtDefinitionA|dtDefinitionB|primaryDtDefinitionName|foreignDtDefinitionName) = ")([A-Z0-9_]+)"/g, function(match, p1, p2, index) {
							   return p1+upperCamelCase(p2)+"\"";
							});
				 			//replace in methods
				 			result = result.replace(/((?:createDtListURIForNNAssociation|createUID)\(this, ")([A-Z0-9_]+)"/g, function(match, p1, p2, after, index) {
							   return p1+lowerCamelCase(p2)+"\"";
							});
						    self.setToken(result);
						</scriptfilter>
					</tokenfilter>
				</filterchain>
			</copy> 
		</target>
		
	<target name="CONST KSP to CamelCase ksp" description="Replace old ksp definitions to CamelCase definition new in vertigo 2.0">
		<copy todir="${src.path}\generated-ksp" encoding="${src.encoding}" overwrite="true">
			<fileset dir="${src.path}">
				<include name="**/*.ksp" />
			</fileset>
			<filterchain>
			 	<tokenfilter>
			 		<scriptfilter language="javascript">
						function upperCamelCase(str) {
						  return str.replace(/((?:\W|^)\w)|_+(\w)|\w/g, function(match, p1, p2, index) {
						   if (p1) { return p1.toUpperCase();} 
						   if (p2) { return p2.toUpperCase();} 
						   return match.toLowerCase();
						  });
						}
			 			function lowerCamelCase(str) {
						  return str.replace(/((?:\W|^)\w)|_+(\w)|\w/g, function(match, p1, p2, index) {
						   if (p1) { return p1.toLowerCase();} 
						   if (p2) { return p2.toUpperCase();} 
						   return match.toLowerCase();
						  });
						}
			 			//replace definitions
						var result = self.getToken().replace(/(\W|^(?:create|alter)\s+)([A-Z][a-zA-Z]+\s+)([A-Z0-9_]+)(\s*\{)/g, function(match, verb, p1, p2, after, index) {
						   return verb+p1+upperCamelCase(p2)+after;
						});
			 			//replace fields
			 			result = result.replace(/(\W(?:id|field|range|indexCopyTo)\s+)([A-Z0-9_]+)(\s*\{)/g, function(match, p1, p2, after, index) {
						   return p1+lowerCamelCase(p2)+after;
						});
			 			//replace attributes
			 			result = result.replace(/(\W(?:formatter|dtDefinition|keyConcept|dtIndex|domain|domainCriteria|dtDefinitionA|dtDefinitionB))(\s*:\s*)([A-Z0-9_]+\W*)/g, function(match, attr, p1, p2, index) {
			 			   return attr+p1+upperCamelCase(p2);
			 			});
			 			//replace lower attributes
			 			result = result.replace(/(\W(?:fkFieldName|fieldName))(\s*:\s*)([\"A-Z0-9_]+\W*)/g, function(match, attr, p1, p2, index) {
			 			   return attr+p1+lowerCamelCase(p2);
			 			});
			 			//replace multiple attributes
			 			result = result.replace(/(\W(?:facets|constraint|from))(\s*:\s*)([\[\]\s,A-Z0-9_]+\W*)/g, function(match, attr, p1, p2, index) {
			 			   return attr+p1+upperCamelCase(p2);
			 			});
			 			//replace lower request attributes
			 			result = result.replace(/\#([A-Z0-9_]+\#)/g, function(match, p1, index) {
			 			   return "#"+lowerCamelCase(p1)+"#";
			 			});
					    self.setToken(result);
					</scriptfilter>
				</tokenfilter>
			</filterchain>
		</copy> 
	</target>
	
	<!-- ====================================================================== -->
	<!-- Replace quarto's ksp definitions by a Java definition provider         -->
	<!-- ====================================================================== -->
	<target name="0.9.3 to 0.9.4 publisher definitions from ksp to Java" description="Replace quarto's ksp definitions by a Java definition provider">
		<copy todir="${src.path}" >
			<fileset dir="${src.path}">
				<include name="**/*.ksp" />
				<containsregexp expression="create(\s)*(PublisherNode|PublisherDefinition)"/>
			</fileset>
			<globmapper from="*.ksp" to="*.ksp2java" casesensitive="no"/>
		</copy>

		<replaceregexp encoding="${src.encoding}" flags="gis" byline="false">
			<fileset dir="${src.path}">
				<include name="**/*.ksp2java" />
			</fileset>
			<regexp pattern="\n\s*\}\s*\n" />
			<substitution expression=".build();${line.separator}${line.separator}" />
		</replaceregexp>
		<replaceregexp encoding="${src.encoding}" flags="gis" byline="false">
					<fileset dir="${src.path}">
						<include name="**/*.ksp2java" />
					</fileset>
					<regexp pattern="\n\s*\}" />
					<substitution expression=".build();${line.separator}${line.separator}}" />
		</replaceregexp>
		
		<replaceregexp encoding="${src.encoding}" flags="gis" byline="false">
			<fileset dir="${src.path}">
				<include name="**/*.ksp2java" />
			</fileset>
			<regexp pattern="package\s*([A-Za-z0-9\.]*)\.([A-Za-z0-9]+)" />
			<substitution expression="package \1.\2;
				${line.separator}import java.util.List;
				${line.separator}import io.vertigo.core.definition.Definition;
				${line.separator}import io.vertigo.core.definition.DefinitionSpace;
				${line.separator}import io.vertigo.core.definition.SimpleDefinitionProvider;
				${line.separator}import io.vertigo.quarto.services.publisher.metamodel.PublisherDataDefinition;
				${line.separator}import io.vertigo.quarto.services.publisher.metamodel.PublisherNodeDefinition;
				${line.separator}import io.vertigo.quarto.services.publisher.metamodel.PublisherNodeDefinitionBuilder;
				${line.separator}import io.vertigo.util.ListBuilder;
				${line.separator}
				${line.separator}public final class \2PublisherDefinitionProvider implements SimpleDefinitionProvider {
				${line.separator}
				${line.separator}@Override
				${line.separator}public List&lt;Definition&gt; provideDefinitions(final DefinitionSpace definitionSpace) {
				${line.separator}		return new ListBuilder&lt;Definition&gt;()
				${line.separator}				.add(/*TODO*/)
				${line.separator}				.build();
				${line.separator}	} " />
		</replaceregexp>
		<replaceregexp encoding="${src.encoding}" flags="gis" byline="false">
			<fileset dir="${src.path}">
				<include name="**/*.ksp2java" />
			</fileset>
			<regexp pattern="create\s*PublisherNode\s*([A-Za-z_0-9]+)\s*\{" />
			<substitution expression="private final PublisherNodeDefinition \1 = new PublisherNodeDefinitionBuilder()" />
		</replaceregexp>
		<replaceregexp encoding="${src.encoding}" flags="gis" byline="false">
			<fileset dir="${src.path}">
				<include name="**/*.ksp2java" />
			</fileset>
			<regexp pattern="stringField\s*([A-Za-z_0-9]+)\s*\{\s*\}" />
			<substitution expression=".addStringField(&quot;\1&quot;)" />
		</replaceregexp>
		<replaceregexp encoding="${src.encoding}" flags="gis" byline="false">
			<fileset dir="${src.path}">
				<include name="**/*.ksp2java" />
			</fileset>
			<regexp pattern="booleanField\s*([A-Za-z_0-9]+)\s*\{\s*\}" />
			<substitution expression=".addBooleanField(&quot;\1&quot;)" />
		</replaceregexp>
		<replaceregexp encoding="${src.encoding}" flags="gis" byline="false">
			<fileset dir="${src.path}">
				<include name="**/*.ksp2java" />
			</fileset>
			<regexp pattern="imageField\s*([A-Za-z_0-9]+)\s*\{\s*\}" />
			<substitution expression=".addImageField(&quot;\1&quot;)" />
		</replaceregexp>
		<replaceregexp encoding="${src.encoding}" flags="gis" byline="false">
			<fileset dir="${src.path}">
				<include name="**/*.ksp2java" />
			</fileset>
			<regexp pattern="dataField\s*([A-Za-z_0-9]+)\s*\{\s*type\s*:\s*([A-Za-z_0-9]+)\s*\}" />
			<substitution expression=".addNodeField(&quot;\1&quot;, \2)" />
		</replaceregexp>
		<replaceregexp encoding="${src.encoding}" flags="gis" byline="false">
			<fileset dir="${src.path}">
				<include name="**/*.ksp2java" />
			</fileset>
			<regexp pattern="listField\s*([A-Za-z_0-9]+)\s*\{\s*type\s*:\s*([A-Za-z_0-9]+)\s*\}" />
			<substitution expression=".addListField(&quot;\1&quot;, \2)" />
		</replaceregexp>
		<replaceregexp encoding="${src.encoding}" flags="gis" byline="false">
			<fileset dir="${src.path}">
				<include name="**/*.ksp2java" />
			</fileset>
			<regexp pattern="create\s*PublisherDefinition\s*([A-Za-z_0-9]+)\s*\{\s*root\s*:\s*([A-Za-z_0-9]+)(\s)*\}" />
			<substitution expression="private final PublisherDataDefinition \1 = new PublisherDataDefinition(&quot;\1&quot;, \2);" />
		</replaceregexp>
	</target>

	<!-- ====================================================================== -->
	<!-- Generation des classes de tests                                        -->
	<!-- ====================================================================== -->
	<target name="0.9.3 to 0.9.4" description="Usefull renames from 0.9.3 to 0.9.4">

		<echo message="Renamed in *.java : io.vertigo.lang.Describable to io.vertigo.core.component.Describable" />
		<replace dir="${src.path}" encoding="${src.encoding}" token="io.vertigo.lang.Describable" value="io.vertigo.core.component.Describable" summary="true">
			<include name="**/*.java" />
		</replace>

		<echo message="Renamed in *.java : io.vertigo.core.spaces.component. to io.vertigo.core.component." />
		<replace dir="${src.path}" encoding="${src.encoding}" token="io.vertigo.core.spaces.component." value="io.vertigo.core.component." summary="true">
			 <include name="**/*.java" />
		</replace>

		<echo message="Renamed in *.java : new WrappedException(.*, e); to WrappedException.wrap(e, msg)" />
		<replaceregexp encoding="${src.encoding}" flags="gis" byline="false">
			<fileset dir="${src.path}">
				<include name="**/*.java" />
			</fileset>
			<regexp pattern="new WrappedException\((&quot;.+&quot;), e\);" />
			<substitution expression="WrappedException.wrap(e, \1);" />
		</replaceregexp>
		
		<echo message="Renamed in *.java : new WrappedException(e); to WrappedException.wrap(e);" />
		<replaceregexp encoding="${src.encoding}" flags="gis" byline="true">
			<fileset dir="${src.path}">
				<include name="**/*.java" />
			</fileset>
			<regexp pattern="throw new WrappedException\((.+)\);" />
			<substitution expression="throw WrappedException.wrap\(\1\);" />
		</replaceregexp>
		
		<echo message="Renamed in *.java : WrappedException.wrapIfNeeded(e); to WrappedException.wrap(e);" />
		<replaceregexp encoding="${src.encoding}" flags="gis" byline="true">
			<fileset dir="${src.path}">
				<include name="**/*.java" />
			</fileset>
			<regexp pattern="throw WrappedException.wrapIfNeeded\((.+)\);" />
			<substitution expression="throw WrappedException.wrap\(\1\);" />
		</replaceregexp>

		<echo message="Renamed in *.java : Injector to DIInjector" />
		<replace dir="${src.path}" encoding="${src.encoding}" token=".Injector;" value=".DIInjector;" summary="true">
			<include name="**/*.java" />
		</replace>
		<replace dir="${src.path}" encoding="${src.encoding}" token=" Injector." value=" DIInjector." summary="true">
			<include name="**/*.java" />
		</replace>
		<replace dir="${src.path}" encoding="${src.encoding}" token="\tInjector." value="\tDIInjector." summary="true">
			<include name="**/*.java" />
		</replace>

		<echo message="Renamed in *.java : io.vertigo.core.spaces.definiton. to io.vertigo.core.definition." />
		<replace dir="${src.path}" encoding="${src.encoding}" token="io.vertigo.core.spaces.definiton." value="io.vertigo.core.definition." summary="true">
			<include name="**/*.java" />
		</replace>

		<echo message="Renamed in *.java : .getStringValue(&quot;([a-zA-Z0-9\.]+)&quot;); to .getParam(\1).getValueAsString" />
		<replaceregexp encoding="${src.encoding}" flags="gis" byline="false">
			<fileset dir="${src.path}">
				<include name="**/*.java" />
			</fileset>
			<regexp pattern="\.getStringValue\(&quot;([a-zA-Z0-9\.]+)&quot;\)" />
			<substitution expression=".getParam(&quot;\1&quot;).getValueAsString()" />
		</replaceregexp>
		
		<echo message="Renamed in *.java : .getBooleanValue(&quot;([a-zA-Z0-9\.]+)&quot;); to .getParam(\1).getValueAsBoolean" />
		<replaceregexp encoding="${src.encoding}" flags="gis" byline="false">
			<fileset dir="${src.path}">
				<include name="**/*.java" />
			</fileset>
			<regexp pattern="\.getBooleanValue\(&quot;([a-zA-Z0-9\.]+)&quot;\)" />
			<substitution expression=".getParam(&quot;\1&quot;).getValueAsBoolean()" />
		</replaceregexp>
		
		<echo message="Renamed in *.java : .getIntValue(&quot;([a-zA-Z0-9\.]+)&quot;); to .getParam(\1).getValueAsInt" />
		<replaceregexp encoding="${src.encoding}" flags="gis" byline="false">
			<fileset dir="${src.path}">
				<include name="**/*.java" />
			</fileset>
			<regexp pattern="\.getIntValue\(&quot;([a-zA-Z0-9\.]+)&quot;\)" />
			<substitution expression=".getParam(&quot;\1&quot;).getValueAsInt()" />
		</replaceregexp>
		
		<echo message="Renamed in *.java : .getLongValue(&quot;([a-zA-Z0-9\.]+)&quot;); to .getParam(\1).getValueAsLong" />
		<replaceregexp encoding="${src.encoding}" flags="gis" byline="false">
			<fileset dir="${src.path}">
				<include name="**/*.java" />
			</fileset>
			<regexp pattern="\.getLongValue\(&quot;([a-zA-Z0-9\.]+)&quot;\)" />
			<substitution expression=".getParam(&quot;\1&quot;).getValueAsLong()" />
		</replaceregexp>
		
		<echo message="Renamed in *.xml : io.vertigo.x.([a-zA-Z]+).account to io.vertigo.x.account.\1" />
		<replaceregexp encoding="${src.encoding}" flags="gis" byline="false">
			<fileset dir="${src.path}">
				<include name="**/*.xml" />
			</fileset>
			<regexp pattern="io\.vertigo\.x\.([a-zA-Z]+)\.account" />
			<substitution expression="io.vertigo.x.account.\1" />
		</replaceregexp>
		
		<echo message="Renamed in *.xml : io.vertigo.x.([a-zA-Z]+).audit to io.vertigo.x.audit.\1" />
		<replaceregexp encoding="${src.encoding}" flags="gis" byline="false">
			<fileset dir="${src.path}">
				<include name="**/*.xml" />
			</fileset>
			<regexp pattern="io\.vertigo\.x\.([a-zA-Z]+)\.audit" />
			<substitution expression="io.vertigo.x.audit.\1" />
		</replaceregexp>
		
		<echo message="Renamed in *.xml : io.vertigo.x.([a-zA-Z]+).comment to io.vertigo.x.comment.\1" />
		<replaceregexp encoding="${src.encoding}" flags="gis" byline="false">
			<fileset dir="${src.path}">
				<include name="**/*.xml" />
			</fileset>
			<regexp pattern="io\.vertigo\.x\.([a-zA-Z]+)\.comment" />
			<substitution expression="io.vertigo.x.comment.\1" />
		</replaceregexp>
		
		<echo message="Renamed in *.xml : io.vertigo.x.([a-zA-Z]+).notification to io.vertigo.x.notification.\1" />
		<replaceregexp encoding="${src.encoding}" flags="gis" byline="false">
			<fileset dir="${src.path}">
				<include name="**/*.xml" />
			</fileset>
			<regexp pattern="io\.vertigo\.x\.([a-zA-Z]+)\.notification" />
			<substitution expression="io.vertigo.x.notification.\1" />
		</replaceregexp>
		
		<echo message="Renamed in *.xml : io.vertigo.x.([a-zA-Z]+).rules to io.vertigo.x.rules.\1" />
		<replaceregexp encoding="${src.encoding}" flags="gis" byline="false">
			<fileset dir="${src.path}">
				<include name="**/*.xml" />
			</fileset>
			<regexp pattern="io\.vertigo\.x\.([a-zA-Z]+)\.rules" />
			<substitution expression="io.vertigo.x.rules.\1" />
		</replaceregexp>
		
		
		<echo message="Renamed in *.xml : api=&quot;([a-zA-Z]+)Manager&quot; class=&quot;io.vertigo.x.([a-zA-Z\.]+)Manager to api=&quot;\1Services&quot; class=&quot;io.vertigo.x.\2Services" />
		<replaceregexp encoding="${src.encoding}" flags="gis" byline="false">
			<fileset dir="${src.path}">
				<include name="**/*.xml" />
			</fileset>
			<regexp pattern="api=&quot;([a-zA-Z]+)Manager&quot; class=&quot;io\.vertigo\.x\.([a-zA-Z\.]+)Manager" />
			<substitution expression="api=&quot;\1Services&quot; class=&quot;io.vertigo.x.\2Services" />
		</replaceregexp>
		
		<echo message="Renamed in *.xml : api=&quot;WorkflowServices&quot; class=&quot;io.vertigo.x.impl.workflow.WorkflowServices to api=&quot;WorkflowManager&quot; class=&quot;io.vertigo.x.impl.workflow.WorkflowManager" />
		<replace dir="${src.path}" encoding="${src.encoding}" token="api=&quot;WorkflowServices&quot; class=&quot;io.vertigo.x.impl.workflow.WorkflowServices" value="api=&quot;WorkflowManager&quot; class=&quot;io.vertigo.x.impl.workflow.WorkflowManager" summary="true">
			<include name="**/*.xml" />
		</replace>
		
		<echo message="Renamed in *.xml : io.vertigo.x.account.impl.services.AccountServicesImpl to io.vertigo.x.account.impl.services.AccountServicesImpl" />
		<replace dir="${src.path}" encoding="${src.encoding}" token="io.vertigo.x.account.impl.services.AccountServicesImpl" value="io.vertigo.x.account.impl.services.AccountServicesImpl" summary="true">
			<include name="**/*.xml" />
		</replace>
		
		
		
	</target>

	<target name="0.9.2 to 0.9.3" description="Usefull renames from 0.9.2 to 0.9.3">
		<echo message="Renamed in *.java : io.vertigo.lang.Option to java.util.Optional" />
		<replace dir="${src.path}" encoding="${src.encoding}" token="io.vertigo.lang.Option" value="java.util.Optional" summary="true">
			<include name="**/*.java" />
		</replace>
		<echo message="Renamed in *.java : Option&lt; to Optional&lt;" />
		<replace dir="${src.path}" encoding="${src.encoding}" token="Option&lt;" value="Optional&lt;" summary="true">
			<include name="**/*.java" />
		</replace>
		<echo message="Renamed in *.java : Option. to Optional." />
		<replace dir="${src.path}" encoding="${src.encoding}" token="Option." value="Optional." summary="true">
			<include name="**/*.java" />
		</replace>
		<echo message="Replace in *.ksp persistent: &quot;false&quot;,\n(\t)+key to field" />
		<replaceregexp encoding="${src.encoding}" flags="gis" byline="false">
			<fileset dir="${src.path}">
				<include name="**/*.ksp" />
			</fileset>
			<regexp pattern="persistent\s*:\s*&quot;false&quot;(,)?\s*\n(\s+)key " />
			<substitution expression="field " />
		</replaceregexp>
		<echo message="Replace in *.ksp persistent: &quot;false&quot;,\n(\t)+field to field" />
		<replaceregexp encoding="${src.encoding}" flags="gis" byline="false">
			<fileset dir="${src.path}">
				<include name="**/*.ksp" />
			</fileset>
			<regexp pattern="persistent\s*:\s*&quot;false&quot;(,)?\s*\n(\s+)field " />
			<substitution expression="field " />
		</replaceregexp>
		<echo message="Replace in *.java &lt;D extends DtObject&gt; URI&lt;D&gt; to &lt;E extends Entity&gt; URI&lt;E&gt;" />
		<replace dir="${src.path}" encoding="${src.encoding}" token="&lt;D extends DtObject&gt; URI&lt;D&gt;" value="&lt;E extends Entity&gt; URI&lt;E&gt;" summary="true">
			<include name="**/*.java" />
		</replace>

		<echo message="Replace in *SearchLoader.java super(taskManager); to super(taskManager, transactionManager);" />
		<replaceregexp encoding="${src.encoding}" flags="gis" byline="false">
			<fileset dir="${src.path}">
				<include name="**/*SearchLoader.java" />
			</fileset>
			<regexp pattern="\)\s+\{\s*\n(\s+)super\(taskManager\);" />
			<substitution expression=", final VTransactionManager transactionManager) {${line.separator}\1super(taskManager, transactionManager);" />
		</replaceregexp>

		<echo message="Replace in *SearchLoader.java import io.vertigo.dynamo.task.TaskManager; to import io.vertigo.dynamo.task.TaskManager;\nimport io.vertigo.dynamo.transaction.VTransactionManager;" />
		<replace dir="${src.path}" encoding="${src.encoding}" token="import io.vertigo.dynamo.task.TaskManager;" value="import io.vertigo.dynamo.task.TaskManager;${line.separator}import io.vertigo.dynamo.transaction.VTransactionManager;" summary="true">
			<include name="**/*SearchLoader.java" />
		</replace>

		<echo message="Replace in *SearchLoader.java loadData(final List&lt;URI&lt;?&gt;&gt; to loadData(final SearchChunk&lt;?&gt; searchChunk) { final List&lt;URI&lt;?&gt;&gt; uris = searchChunk.getAllURIs();" />
		<replaceregexp encoding="${src.encoding}" flags="gis" byline="false">
			<fileset dir="${src.path}">
				<include name="**/*SearchLoader.java" />
			</fileset>
			<regexp pattern="loadData\(\n?\s*final\s+List&lt;URI&lt;([A-Za-z0-9]+)&gt;&gt;\s+([A-Za-z0-9]+)\)\s+\{\s+\n(\s+)" />
			<substitution expression="loadData(final SearchChunk&lt;\1&gt; searchChunk) \{${line.separator}\3final List&lt;URI&lt;\1&gt;&gt; \2 = searchChunk.getAllURIs();${line.separator}\3" />
		</replaceregexp>

		<echo message="Replace in *SearchLoader.java import io.vertigo.dynamo.search.metamodel.SearchIndexDefinition; to import io.vertigo.dynamo.search.metamodel.SearchChunk;\\nimport io.vertigo.dynamo.search.metamodel.SearchIndexDefinition;" />
		<replace dir="${src.path}" encoding="${src.encoding}" token="import io.vertigo.dynamo.search.metamodel.SearchIndexDefinition;" value="import io.vertigo.dynamo.search.metamodel.SearchChunk;${line.separator}import io.vertigo.dynamo.search.metamodel.SearchIndexDefinition;" summary="true">
			<include name="**/*SearchLoader.java" />
		</replace>
		<echo message="Replace in *.xml io.vertigo.quarto.impl.export. to io.vertigo.quarto.impl.export." />
		<replace dir="${src.path}" encoding="${src.encoding}" token="io.vertigo.quarto.impl.export." value="io.vertigo.quarto.impl.export." summary="true">
			<include name="**/*.xml" />
		</replace>
		<echo message="Replace in *.xml io.vertigo.quarto.plugins.export. to io.vertigo.quarto.plugins.export." />
		<replace dir="${src.path}" encoding="${src.encoding}" token="io.vertigo.quarto.plugins.export." value="io.vertigo.quarto.plugins.export." summary="true">
			<include name="**/*.xml" />
		</replace>


	</target>

	<target name="0.9.1 to 0.9.2" description="Usefull renames from 0.9.1 to 0.9.2">
		<echo message="Renamed in *.java : Option.some( to Option.of(" />
		<replace summary="true" dir="${src.path}" encoding="${src.encoding}" token="Option.some(" value="Option.of(">
			<include name="**/*.java" />
		</replace>
		<echo message="Renamed in *.java : Option.option( to Option.ofNullable(" />
		<replace summary="true" dir="${src.path}" encoding="${src.encoding}" token="Option.option(" value="Option.ofNullable(">
			<include name="**/*.java" />
		</replace>
		<echo message="Renamed in *.java : .isDefined() to .isPresent()" />
		<replace summary="true" dir="${src.path}" encoding="${src.encoding}" token=".isDefined()" value=".isPresent()">
			<include name="**/*.java" />
		</replace>
		<echo message="Renamed in *.java : .getOrElse( to .orElse(" />
		<replace summary="true" dir="${src.path}" encoding="${src.encoding}" token=".getOrElse(" value=".orElse(">
			<include name="**/*.java" />
		</replace>
		<echo message="Renamed in *.java : .none() to .empty()" />
		<replace summary="true" dir="${src.path}" encoding="${src.encoding}" token=".none()" value=".empty()">
			<include name="**/*.java" />
		</replace>
		<!-- Can't do that too many false positive 
		<echo message="Replace in *.java opt.isEmpty() to !opt.isPresent()" />
		<replaceregexp encoding="${src.encoding}" flags="gis" byline="false">
			<fileset dir="${src.path}">
				<include name="**/*.java"/>
			</fileset>
			<regexp pattern="([a-z][a-zA-Z]+)\.isEmpty\(\)" />
				<substitution expression="!\1.isPresent()" />
		</replaceregexp> -->
	</target>

	<target name="0.9.0 to 0.9.1" description="Usefull renames from 0.9.0 to 0.9.1">
		<echo message="Renamed in *.java : getFileStore().get( to getFileStore().read(" />
		<replace summary="true" dir="${src.path}" encoding="${src.encoding}" token="getFileStore().get(" value="getFileStore().read(">
			<include name="**/*.java" />
		</replace>
		<echo message="Renamed in *.xml : .event.EventManagerImpl to .eventbus.EventBusManagerImpl" />
		<replace summary="true" dir="${src.path}" encoding="${src.encoding}" token=".event.EventManagerImpl" value=".eventbus.EventManagerImpl">
			<include name="**/*.xml" />
			<exclude name="update-renaming-tool.xml" />
		</replace>
		<echo message="Renamed in *.xml : EventManager to EventBusManager" />
		<replace summary="true" dir="${src.path}" encoding="${src.encoding}" token="EventManager" value="EventBusManager">
			<include name="**/*.xml" />
			<exclude name="update-renaming-tool.xml" />
		</replace>
	</target>


	<target name="0.8.3 to 0.9.0" description="Usefull renames from 0.8.3 to 0.9.0">
		<!-- <echo message="Renamed in LocalManager in boot : LocalManager to <boot local=\'<boot>\'" />
				<replace summary="true" dir="${src.path}" encoding="${src.encoding}"
					token="io.vertigo.dynamox.search.DefaultListFilterBuilder" value="io.vertigo.dynamox.search.DslListFilterBuilder">
					<include name="**/*.xml"/>
					<exclude name="update-renaming-tool.xml"/>
				</replace>
				-->
		<echo message="Renamed in *.xml : io.vertigo.commons.plugins.resource.java.ClassPathResourceResolverPlugin to io.vertigo.core.plugins.resource.classpath.ClassPathResourceResolverPlugin" />
		<replace summary="true" dir="${src.path}" encoding="${src.encoding}" token="io.vertigo.commons.plugins.resource.java.ClassPathResourceResolverPlugin" value="io.vertigo.core.plugins.resource.classpath.ClassPathResourceResolverPlugin">
			<include name="**/*.xml" />
			<exclude name="update-renaming-tool.xml" />
		</replace>
		<echo message="Renamed in *.xml : io.vertigo.core.plugins.config.xml.XmlConfigPlugin to io.vertigo.core.plugins.param.xml.XmlParamPlugin" />
		<replace summary="true" dir="${src.path}" encoding="${src.encoding}" token="io.vertigo.core.plugins.config.xml.XmlConfigPlugin" value="io.vertigo.core.plugins.param.xml.XmlParamPlugin">
			<include name="**/*.xml" />
			<exclude name="update-renaming-tool.xml" />
		</replace>

		<echo message="Renamed in *.xml : &lt;property to &lt;param" />
		<replace summary="true" dir="${src.path}" encoding="${src.encoding}" token="&lt;property " value="&lt;param ">
			<include name="**/*.xml" />
			<exclude name="update-renaming-tool.xml" />
		</replace>
		<!-- Can't replace because of too many false positives 
			<echo message="Renamed in *.xml : &lt;/property to &lt;/param" />
			<replace summary="true" dir="${src.path}" encoding="${src.encoding}" token="&lt;/property" value="&lt;/param">
				<include name="**/*.xml" />
				<exclude name="update-renaming-tool.xml" />
			</replace>
			-->
		<echo message="Renamed in *.xml : &lt;config to &lt;path" />
		<replace summary="true" dir="${src.path}" encoding="${src.encoding}" token="&lt;config " value="&lt;path ">
			<include name="**/*.xml" />
			<exclude name="update-renaming-tool.xml" />
		</replace>
		<!-- Can't replace because of too many false positives 
			<echo message="Renamed in *.xml : &lt;/config to &lt;/path" />
			<replace summary="true" dir="${src.path}" encoding="${src.encoding}" token="&lt;/config" value="&lt;/path">
				<include name="**/*.xml" />
				<exclude name="update-renaming-tool.xml" />
			</replace -->

		<echo message="Renamed in *.xml : &lt;application-config to &lt;config" />
		<replace summary="true" dir="${src.path}" encoding="${src.encoding}" token="&lt;application-config" value="&lt;config">
			<include name="**/*.xml" />
			<exclude name="update-renaming-tool.xml" />
		</replace>

		<echo message="Renamed in *.xml : &lt;/application-config to &lt;/config" />
		<replace summary="true" dir="${src.path}" encoding="${src.encoding}" token="&lt;/application-config" value="&lt;/config">
			<include name="**/*.xml" />
			<exclude name="update-renaming-tool.xml" />
		</replace>

		<echo message="Renamed in *.java : io.vertigo.core.Home to io.vertigo.app.Home" />
		<replace summary="true" dir="${src.path}" encoding="${src.encoding}" token="io.vertigo.core.Home" value="io.vertigo.app.Home">
			<include name="**/*.java" />
		</replace>
		<echo message="Renamed in *.java : io.vertigo.core.App and AppListener to io.vertigo.app.App" />
		<replace summary="true" dir="${src.path}" encoding="${src.encoding}" token="io.vertigo.core.App" value="io.vertigo.app.App">
			<include name="**/*.java" />
		</replace>
		<echo message="Renamed in *.java : io.vertigo.core.Boot to io.vertigo.app.Boot" />
		<replace summary="true" dir="${src.path}" encoding="${src.encoding}" token="io.vertigo.core.Boot" value="io.vertigo.app.Boot">
			<include name="**/*.java" />
		</replace>
		<echo message="Renamed in *.java : io.vertigo.core.config. to io.vertigo.app.config." />
		<replace summary="true" dir="${src.path}" encoding="${src.encoding}" token="io.vertigo.core.config." value="io.vertigo.app.config.">
			<include name="**/*.java" />
		</replace>
		<echo message="Renamed in *.java : Home.getComponentSpace() to Home.getApp().getComponentSpace()" />
		<replace summary="true" dir="${src.path}" encoding="${src.encoding}" token="Home.getComponentSpace()" value="Home.getApp().getComponentSpace()">
			<include name="**/*.java" />
		</replace>
		<echo message="Renamed in *.java : Home.getDefinitionSpace() to Home.getApp().getDefinitionSpace()" />
		<replace summary="true" dir="${src.path}" encoding="${src.encoding}" token="Home.getDefinitionSpace()" value="Home.getApp().getDefinitionSpace()">
			<include name="**/*.java" />
		</replace>
		<echo message="Renamed in *.java : ConfigManager to ParamManager" />
		<replace summary="true" dir="${src.path}" encoding="${src.encoding}" token="ConfigManager" value="ParamManager">
			<include name="**/*.java" />
		</replace>

	</target>

	<target name="0.8.2 to 0.8.3" description="Usefull renames from 0.8.2 to 0.8.3">
		<echo message="Renamed in *.ksp : io.vertigo.dynamox.search.DslListFilterBuilderDefaultListFilterBuilder to io.vertigo.dynamox.search.DslListFilterBuilderDslListFilterBuilder" />
		<replace summary="true" dir="${src.path}" encoding="${src.encoding}" token="io.vertigo.dynamox.search.DefaultListFilterBuilder" value="io.vertigo.dynamox.search.DslListFilterBuilder">
			<include name="**/*.ksp" />
		</replace>

		<echo message="Renamed in pom.xml : &lt;vertigo.version&gt;0.8.2&lt;/vertigo.version&gt; to &lt;vertigo.version&gt;0.8.3&lt;/vertigo.version&gt;" />
		<replace summary="true" dir="${src.path}" encoding="${src.encoding}" token="&lt;vertigo.version&gt;0.8.2&lt;/vertigo.version&gt;" value="&lt;vertigo.version&gt;0.8.3&lt;/vertigo.version&gt;">
			<include name="**/pom.xml" />
		</replace>
	</target>

	<target name="0.8.1 to 0.8.2" description="Usefull renames from 0.8.1 to 0.8.2">
		<echo message="Renamed in *.xml : io.vertigo.vega.rest.* to io.vertigo.vega.webservice.*" />
		<replace summary="true" dir="${src.path}" encoding="${src.encoding}" token="io.vertigo.vega.rest." value="io.vertigo.vega.webservice.">
			<include name="**/*.xml" />
			<exclude name="update-renaming-tool.xml" />
		</replace>

		<echo message="Renamed in pom.xml : &lt;vertigo.version&gt;0.8.1&lt;/vertigo.version&gt; to &lt;vertigo.version&gt;0.8.2&lt;/vertigo.version&gt;" />
		<replace summary="true" dir="${src.path}" encoding="${src.encoding}" token="&lt;vertigo.version&gt;0.8.1&lt;/vertigo.version&gt;" value="&lt;vertigo.version&gt;0.8.2&lt;/vertigo.version&gt;">
			<include name="**/pom.xml" />
		</replace>


		<echo message="Renamed in *.java : import io.vertigo.vega.rest.* to io.vertigo.vega.webservice.*" />
		<replace summary="true" dir="${src.path}" encoding="${src.encoding}" token="import io.vertigo.vega.rest." value="import io.vertigo.vega.webservice.">
			<include name="**/*.java" />
		</replace>

		<echo message="Renamed in *.java : &quot;vertigo.rest.Session&quot; to &quot;vertigo.webservice.Session&quot;" />
		<replace summary="true" dir="${src.path}" encoding="${src.encoding}" token="&quot;vertigo.rest.Session&quot;" value="&quot;vertigo.webservice.Session&quot;">
			<include name="**/*.java" />
		</replace>

		<echo message="Renamed in *.xml : io.vertigo.vega.impl.rest.RestManagerImpl to io.vertigo.vega.impl.webservice.WebServiceManagerImpl" />
		<replace summary="true" dir="${src.path}" encoding="${src.encoding}" token="io.vertigo.vega.impl.rest.RestManagerImpl" value="io.vertigo.vega.impl.webservice.WebServiceManagerImpl">
			<include name="**/*.xml" />
			<exclude name="update-renaming-tool.xml" />
		</replace>

		<echo message="Renamed in *.xml : RestManager to WebServiceManager" />
		<replace summary="true" dir="${src.path}" encoding="${src.encoding}" token="RestManager" value="WebServiceManager">
			<include name="**/*.xml" />
			<exclude name="update-renaming-tool.xml" />
		</replace>

		<echo message="Renamed in *.java : extends DefaultSearchLoader to extends AbstractSqlSearchLoader" />
		<replace summary="true" dir="${src.path}" encoding="${src.encoding}" token="extends DefaultSearchLoader" value="extends AbstractSqlSearchLoader">
			<include name="**/*.java" />
		</replace>

		<echo message="Renamed in *.java : extends .getFileInfo( to extends .get(" />
		<replace summary="true" dir="${src.path}" encoding="${src.encoding}" token=".getFileInfo(" value=".get(">
			<include name="**/*.java" />
		</replace>

		<echo message="Renamed in *.java : .deleteFileInfo( to extends .delete(" />
		<replace summary="true" dir="${src.path}" encoding="${src.encoding}" token=".deleteFileInfo(" value=".delete(">
			<include name="**/*.java" />
		</replace>

		<echo message="Renamed in *.java : getBrokerConfig() to extends getDataStoreConfig()" />
		<replace summary="true" dir="${src.path}" encoding="${src.encoding}" token="getBrokerConfig()" value="getDataStoreConfig()">
			<include name="**/*.java" />
		</replace>

		<echo message="Renamed in *.java : extends DefaultSearchLoader to extends AbstractSqlSearchLoader" />
		<replace summary="true" dir="${src.path}" encoding="${src.encoding}" token="io.vertigo.dynamox.search.DefaultSearchLoader" value="io.vertigo.dynamox.search.AbstractSqlSearchLoader">
			<include name="**/*.java" />
		</replace>

		<echo message="Renamed in *.xml : io.vertigo.vega.plugins.rest.instrospector.annotations.AnnotationsEndPointIntrospectorPlugin to io.vertigo.vega.plugins.webservice.instrospector.annotations.AnnotationsWebServiceIntrospectorPlugin" />
		<replace summary="true" dir="${src.path}" encoding="${src.encoding}" token="io.vertigo.vega.plugins.rest.instrospector.annotations.AnnotationsEndPointIntrospectorPlugin" value="io.vertigo.vega.plugins.webservice.instrospector.annotations.AnnotationsWebServiceIntrospectorPlugin">
			<include name="**/*.xml" />
			<exclude name="update-renaming-tool.xml" />
		</replace>

		<echo message="Renamed in *.xml : io.vertigo.vega.plugins.webservice.webserver.sparkjava.SparkJavaServletFilterWebServerPlugin to io.vertigo.vega.plugins.webservice.webserver.sparkjava.SparkJavaServletFilterWebServerPlugin" />
		<replace summary="true" dir="${src.path}" encoding="${src.encoding}" token="io.vertigo.vega.plugins.rest.routesregister.sparkjava.SparkJavaRoutesRegisterPlugin" value="io.vertigo.vega.plugins.webservice.webserver.sparkjava.SparkJavaServletFilterWebServerPlugin">
			<include name="**/*.xml" />
			<exclude name="update-renaming-tool.xml" />
		</replace>

		<echo message="Renamed in *.xml : io.vertigo.vega.rest.engine.GoogleJsonEngine to io.vertigo.vega.engines.webservice.json.GoogleJsonEngine" />
		<replace summary="true" dir="${src.path}" encoding="${src.encoding}" token="io.vertigo.vega.rest.engine.GoogleJsonEngine" value="io.vertigo.vega.engines.webservice.json.GoogleJsonEngine">
			<include name="**/*.xml" />
			<exclude name="update-renaming-tool.xml" />
		</replace>

		<echo message="Renamed in *.xml : SwaggerWebServices to SwaggerWebServices" />
		<replace summary="true" dir="${src.path}" encoding="${src.encoding}" token="SwaggerRestServices" value="SwaggerWebServices">
			<include name="**/*.xml" />
			<exclude name="update-renaming-tool.xml" />
		</replace>

		<echo message="Renamed in *.xml : XxxxWebRestHandlerPlugin to XxxxWebServiceHandlerPlugin" />
		<replace summary="true" dir="${src.path}" encoding="${src.encoding}" token="RestHandlerPlugin" value="WebServiceHandlerPlugin">
			<include name="**/*.xml" />
			<exclude name="update-renaming-tool.xml" />
		</replace>

		<echo message="Renamed in *.java : import io.vertigo.vega.webservice.RestfulService to import io.vertigo.vega.webservice.WebServices" />
		<replace summary="true" dir="${src.path}" encoding="${src.encoding}" token="import io.vertigo.vega.webservice.RestfulService" value="import io.vertigo.vega.webservice.WebServices">
			<include name="**/*.java" />
		</replace>

		<echo message="Renamed in *.java : implements RestfulService to implements WebServices" />
		<replace summary="true" dir="${src.path}" encoding="${src.encoding}" token="implements RestfulService" value="implements WebServices">
			<include name="**/*.java" />
		</replace>

		<echo message="Renamed in web.xml io.vertigo.vega.impl.rest.servlet.ApplicationServletContextListener to io.vertigo.vega.impl.webservice.servlet.AppServletContextListener" />
		<replace summary="true" dir="${src.path}" encoding="${src.encoding}" token="io.vertigo.vega.impl.rest.servlet.ApplicationServletContextListener" value="io.vertigo.vega.impl.webservice.servlet.AppServletContextListener">
			<include name="**/web.xml" />
		</replace>

		<echo message="Replaced in web.xml spark.servlet.SparkFilter and application by a new VegaSparkFilter" />
		<replaceregexp encoding="${src.encoding}" flags="gis" byline="false">
			<fileset dir="${src.path}">
				<include name="**/web.xml" />
			</fileset>

			<regexp pattern="&lt;filter-name&gt;SparkFilter&lt;/filter-name&gt;
([ \t\n]+?)&lt;filter-class&gt;spark.servlet.SparkFilter&lt;/filter-class&gt;
([ \t\n]+?)&lt;init-param&gt;
([ \t\n]+?)&lt;param-name&gt;applicationClass&lt;/param-name&gt;
([ \t\n]+?)&lt;param-value&gt;io.vertigo.vega.plugins.webservice.routesregister.sparkjava.VegaSparkApplication&lt;/param-value&gt;
([ \t\n]+?)&lt;/init-param&gt;&gt;" />
			<substitution expression="&lt;filter&gt;
([ \t\n]+?)&lt;filter-name&gt;SparkFilter&lt;/filter-name&gt;
([ \t\n]+?)&lt;filter-class&gt;io.vertigo.vega.plugins.webservice.webserver.sparkjava.VegaSparkFilter&lt;/filter-class&gt;    
([ \t\n]+?)&lt;/filter&gt;&gt;" />
		</replaceregexp>

	</target>

</project>
